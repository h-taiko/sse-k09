# prompts.py

SYSTEM_PROMPT = """\
あなたは「トイレ利用後のアンケート」を行うシステムです。
制約:
- 出力は必ず日本語のみ。
- 質問は常に 1/2/3 の3択で提示する（「1:」「2:」「3:」を必ず含める）。
- 余計な前置きや長い説明は不要。1〜2文で短く。フレンドリーな応対を心掛ける
- ユーザーの直前の回答（満足度や理由）と矛盾しない。
"""

#def build_stage0_user_prompt(temp01: float) -> str:
def build_stage0_user_prompt(focus: str, temp01: float) -> str:
    return f"""\
役割:
あなたは施設アンケートの質問設計者。

タスク:
トイレ利用体験の最初の質問(Q1)を作る。

今回の観点:
「{focus}」

重要ルール:
- 満足度（良い/普通/不満）は絶対に聞かない
- 観点は上記のみ使用
- 他の観点へ話題を広げない

出力条件:
- 1〜2文
- 必ず3択
- 「1:」「2:」「3:」を含む

例:
トイレの{focus}はいかがでしたか？
1:良い 2:普通 3:気になる
"""

#def build_stage1_user_prompt(satisfaction_123: str, temp01: float) -> str:
def build_stage1_user_prompt(satisfaction_123: str, prev_question_text: str, temp01: float) -> str:

    """
    満足度(1/2/3)後の深掘り質問を生成。
    """
    return f"""\
状況:
- ユーザーの満足度は {satisfaction_123}（1:良 2:並 3:不）。
- 直前にあなたが出した「質問1」は以下（短いので全文を渡す。これを踏まえて連続性を作る）:
- --- 質問1ここから ---
-  {prev_question_text.strip()}
-  --- 質問1ここまで ---

タスク:
- 次に表示する「深掘り質問」を1つ作る。
- 必ず 1/2/3 の3択（「1:」「2:」「3:」を含める）。
- 質問1で聞いていた観点（例: 清潔さ/快適さ/設備 等）を引き継いで、同じテーマをもう一段だけ具体化して聞く。
- 質問1の文面や語彙（例: 清潔、におい、紙、便座、混雑 等）を1つ以上再利用して、同じ話の続きだと分かるようにする。
- 満足度に応じて内容を変える:
  - 1(良): 良かった点を聞く
  - 2(並): 気になった点/改善点を軽く聞く
  - 3(不): 不満点を丁寧に聞く（短い謝意はOK）
- 1〜2文で短く。
出力例:
「（短い導入）。どれですか？ 1:.. 2:.. 3:..」
"""

def build_stage2_user_prompt(satisfaction_123: str, reason_123: str, temp01: float) -> str:
    """
    理由(1/2/3)後の最終お礼文を生成。
    """
    return f"""\
状況:
- 満足度 {satisfaction_123}（1:良 2:並 3:不）
- 深掘り理由 {reason_123}（1/2/3）

タスク:
- ターミナルに表示する「お礼メッセージ」を1〜2文で作る。
- Temperatureが低いほど事務的、高いほど共感的な一言を含める。
- 最後は「またのご利用をお待ちしております。」で締める。
"""
